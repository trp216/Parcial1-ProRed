package control;

import java.util.UUID;

import com.google.gson.Gson;

import comm.Receptor.OnMessageListener;
import comm.TCPConnection;
import javafx.application.Platform;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import model.Hit;
import model.Generic;
import model.Identification;
import model.Stand;
import view.PlayerWindow;

public class PlayerController implements TCPConnection.OnConnectionListener, OnMessageListener{

	private PlayerWindow view;
	private TCPConnection connection;

	private Identification myID;

	private int score;

	public PlayerController(PlayerWindow view) {
		this.view = view;
		init();
	}

	public void init() {
		connection = TCPConnection.getInstance();
		connection.setConnectionListener(this);

		connection.setIp("127.0.0.1");
		connection.setPuerto(5000);
		connection.start();
	}

	@Override
	public void onConnection() {
		//start game
		view.setStatus("Conectado y esperando adversario");
		view.startGame();
		//dile al server que ya estas pa que te mande cartitas

	}

	@Override
	public void OnMessage(String msg) {
		Gson gson = new Gson();
		Generic type = gson.fromJson(msg, Generic.class);
		
		switch (type.getType()) {
		case "Identification":
			Identification i = gson.fromJson(msg, Identification.class);
			myID = i;
			break;
		case "Card":
			//ME HAN DADO UNA CARTA
			break;

		case "Status":
			//Gano? Pierdo? Empato?
			break;
		}

	}

	//solo de envio
	public void stand() {
		view.getStand().setOnAction( 

				(e) -> {
					Stand s = new Stand(score); //Tenes que llevar la cuenta de la puntuacion hija, pa decirle al dealer
					Gson gson = new Gson();
					String json = gson.toJson(s);
					connection.getEmisor().sendMessage(json);
				}

				);
	}

	//solo de envio
	public void hit() { //cambiar nombre porque esto es empate
		view.getTakeCardButton().setOnAction( 
				(e) -> {
					Hit d = new Hit();
					d.setId(myID.getId());
					Gson gson = new Gson();
					String json = gson.toJson(d);
					connection.getEmisor().sendMessage(json);
				}
				);
	}



}
