package control;

import comm.Receptor.OnMessageListener;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.UUID;

import com.google.gson.Gson;

import comm.TCPConnection;
import comm.TCPConnection.OnConnectionListener;
import javafx.application.Platform;
import model.Card;
import model.Generic;
import model.Hit;
import model.Identification;
import view.DealerWindow;

public class DealerController implements OnMessageListener, OnConnectionListener{
	
	private DealerWindow view;
	private TCPConnection connection;
	
	private ArrayList<Card> dealerCards;
	
	private String idClient1 ;
	private String idClient2 ;
	
	public DealerController(DealerWindow view) {
		this.view = view;
		init();
	}
	
	public void init() {
		connection = TCPConnection.getInstance();
		connection.setPuerto(5000);
		connection.start();
		connection.setConnectionListener(this);
		connection.setMessageListener(this);
		
		dealerCards = new ArrayList<Card>();
		initializeDeck();
	}
	
	public void initializeDeck() {
		for(int i =1;i<=10;i++) {
			Card cD = new Card(i, 'D');
			Card cT = new Card(i, 'T');
			Card cP = new Card(i, 'P');
			Card cC = new Card(i, 'C');
			dealerCards.add(cD);
			dealerCards.add(cT);
			dealerCards.add(cP);
			dealerCards.add(cC);
		}
		createLetterCards('D');
		createLetterCards('T');
		createLetterCards('P');
		createLetterCards('C');
	}
	
	private void createLetterCards(char figure) {
		for(int i = 0;i<4;i++) {
			Card c = new Card(11, figure);
			dealerCards.add(c);
		}
	}
	
	@Override
	public void onConnection(String id) {
//			Platform.runLater(	
//				()->{
//					
//				}
//				
//			);
		System.out.println("Nuevo jugador: " + id);
	}
	
	

	@Override
	public void OnMessage(String msg) {
		Gson gson = new Gson();
		Generic type = gson.fromJson(msg, Generic.class);
		
		switch (type.getType()) {
		case "Hit":
			//ME HAN PEDIDO UNA CARTA
			Hit h = gson.fromJson(msg, Hit.class);
			break;

		case "Status":
			//Gano? Pierdo? Empato?
			break;
		}
		
	}

	//RECUERDA MANDAR DOS CARTAS INICALES A CADA JUGADOR
	public Card hitCard() {
		int random = (int) (Math.random()*dealerCards.size());
		Card toSend = dealerCards.get(random);
		dealerCards.remove(random);
		return toSend;
	}

}
